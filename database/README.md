# üóÑÔ∏è Database - Exodus DayZ Shop

–¶–µ–π –∫–∞—Ç–∞–ª–æ–≥ –º—ñ—Å—Ç–∏—Ç—å –≤—Å—ñ –Ω–µ–æ–±—Ö—ñ–¥–Ω—ñ —Ñ–∞–π–ª–∏ –¥–ª—è —Ä–æ–±–æ—Ç–∏ –∑ –±–∞–∑–æ—é –¥–∞–Ω–∏—Ö –ø—Ä–æ–µ–∫—Ç—É.

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª—ñ–≤

```
database/
‚îú‚îÄ‚îÄ seed.sql        # –ü–æ—á–∞—Ç–∫–æ–≤—ñ –¥–∞–Ω—ñ (—Ç–æ–≤–∞—Ä–∏, —Ä—ñ–≤–Ω—ñ –ª–æ—è–ª—å–Ω–æ—Å—Ç—ñ, –¥–æ—Å—è–≥–Ω–µ–Ω–Ω—è, –ø—Ä–æ–º–æ–∫–æ–¥–∏, –±–∞–Ω–µ—Ä–∏)
‚îú‚îÄ‚îÄ README.md       # –¶–µ–π —Ñ–∞–π–ª –∑ —ñ–Ω—Å—Ç—Ä—É–∫—Ü—ñ—è–º–∏
```

## üöÄ –®–≤–∏–¥–∫–∏–π —Å—Ç–∞—Ä—Ç

### 1. –ó–∞—Å—Ç–æ—Å—É–≤–∞–Ω–Ω—è –º—ñ–≥—Ä–∞—Ü—ñ–π

–ú—ñ–≥—Ä–∞—Ü—ñ—ó –∑–Ω–∞—Ö–æ–¥—è—Ç—å—Å—è –≤ `supabase/migrations/`. –î–ª—è —ó—Ö –∑–∞—Å—Ç–æ—Å—É–≤–∞–Ω–Ω—è:

```bash
# –í—Å—Ç–∞–Ω–æ–≤—ñ—Ç—å Supabase CLI (—è–∫—â–æ —â–µ –Ω–µ –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ)
npm install -g supabase

# –ó–∞–ª–æ–≥—ñ–Ω—å—Ç–µ—Å—å
supabase login

# –ü—Ä–∏–≤'—è–∂—ñ—Ç—å –¥–æ –ø—Ä–æ–µ–∫—Ç—É
supabase link --project-ref YOUR_PROJECT_ID

# –ó–∞—Å—Ç–æ—Å—É–π—Ç–µ –º—ñ–≥—Ä–∞—Ü—ñ—ó
supabase db push
```

### 2. –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –ø–æ—á–∞—Ç–∫–æ–≤–∏—Ö –¥–∞–Ω–∏—Ö

–ü—ñ—Å–ª—è –∑–∞—Å—Ç–æ—Å—É–≤–∞–Ω–Ω—è –º—ñ–≥—Ä–∞—Ü—ñ–π, –∑–∞–≤–∞–Ω—Ç–∞–∂—Ç–µ seed-–¥–∞–Ω—ñ:

**–°–ø–æ—Å—ñ–± A: –ß–µ—Ä–µ–∑ Supabase Dashboard**
1. –í—ñ–¥–∫—Ä–∏–π—Ç–µ SQL Editor –≤ Supabase Dashboard
2. –°–∫–æ–ø—ñ—é–π—Ç–µ –≤–º—ñ—Å—Ç `seed.sql`
3. –í–∏–∫–æ–Ω–∞–π—Ç–µ –∑–∞–ø–∏—Ç

**–°–ø–æ—Å—ñ–± B: –ß–µ—Ä–µ–∑ psql**
```bash
psql -h db.YOUR_PROJECT_ID.supabase.co -U postgres -d postgres -f database/seed.sql
```

## üìä –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –±–∞–∑–∏ –¥–∞–Ω–∏—Ö

### –û—Å–Ω–æ–≤–Ω—ñ —Ç–∞–±–ª–∏—Ü—ñ

| –¢–∞–±–ª–∏—Ü—è | –û–ø–∏—Å | –ó–∞–ø–∏—Å—ñ–≤ |
|---------|------|---------|
| `products` | –¢–æ–≤–∞—Ä–∏ –º–∞–≥–∞–∑–∏–Ω—É | ~25 |
| `profiles` | –ü—Ä–æ—Ñ—ñ–ª—ñ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ | - |
| `orders` | –ó–∞–º–æ–≤–ª–µ–Ω–Ω—è | - |
| `order_items` | –ü–æ–∑–∏—Ü—ñ—ó –∑–∞–º–æ–≤–ª–µ–Ω—å | - |
| `cart_items` | –ö–æ—à–∏–∫ | - |
| `wishlist` | –°–ø–∏—Å–æ–∫ –±–∞–∂–∞–Ω—å | - |
| `reviews` | –í—ñ–¥–≥—É–∫–∏ | - |
| `balance_transactions` | –¢—Ä–∞–Ω–∑–∞–∫—Ü—ñ—ó –±–∞–ª–∞–Ω—Å—É | - |

### –°–∏—Å—Ç–µ–º–Ω—ñ —Ç–∞–±–ª–∏—Ü—ñ

| –¢–∞–±–ª–∏—Ü—è | –û–ø–∏—Å |
|---------|------|
| `loyalty_levels` | –†—ñ–≤–Ω—ñ –ª–æ—è–ª—å–Ω–æ—Å—Ç—ñ (6 —Ä—ñ–≤–Ω—ñ–≤) |
| `achievements` | –î–æ—Å—è–≥–Ω–µ–Ω–Ω—è (5 —à—Ç—É–∫) |
| `promo_codes` | –ü—Ä–æ–º–æ–∫–æ–¥–∏ |
| `homepage_banners` | –ë–∞–Ω–µ—Ä–∏ –≥–æ–ª–æ–≤–Ω–æ—ó —Å—Ç–æ—Ä—ñ–Ω–∫–∏ |
| `notifications` | –°–ø–æ–≤—ñ—â–µ–Ω–Ω—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ |
| `user_roles` | –†–æ–ª—ñ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ |

### –ê–Ω–∞–ª—ñ—Ç–∏–∫–∞ —Ç–∞ –ª–æ–≥—É–≤–∞–Ω–Ω—è

| –¢–∞–±–ª–∏—Ü—è | –û–ø–∏—Å |
|---------|------|
| `product_views` | –ü–µ—Ä–µ–≥–ª—è–¥–∏ —Ç–æ–≤–∞—Ä—ñ–≤ |
| `product_clicks` | –ö–ª—ñ–∫–∏ –Ω–∞ —Ç–æ–≤–∞—Ä–∏ |
| `edge_function_logs` | –õ–æ–≥–∏ Edge Functions |
| `admin_audit_logs` | –ê—É–¥–∏—Ç –¥—ñ–π –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä—ñ–≤ |

## üîê –ë–µ–∑–ø–µ–∫–∞ (RLS)

–í—Å—ñ —Ç–∞–±–ª–∏—Ü—ñ –∑–∞—Ö–∏—â–µ–Ω—ñ Row Level Security (RLS) –ø–æ–ª—ñ—Ç–∏–∫–∞–º–∏:

- **–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ** –º–æ–∂—É—Ç—å —á–∏—Ç–∞—Ç–∏/–∑–º—ñ–Ω—é–≤–∞—Ç–∏ —Ç—ñ–ª—å–∫–∏ —Å–≤–æ—ó –¥–∞–Ω—ñ
- **–ê–¥–º—ñ–Ω–∏** –º–∞—é—Ç—å –ø–æ–≤–Ω–∏–π –¥–æ—Å—Ç—É–ø –¥–æ –≤—Å—ñ—Ö —Ç–∞–±–ª–∏—Ü—å
- **–ü—É–±–ª—ñ—á–Ω—ñ –¥–∞–Ω—ñ** (—Ç–æ–≤–∞—Ä–∏, –¥–æ—Å—è–≥–Ω–µ–Ω–Ω—è) –¥–æ—Å—Ç—É–ø–Ω—ñ –≤—Å—ñ–º –¥–ª—è —á–∏—Ç–∞–Ω–Ω—è

## üîÑ –ë–µ–∫–∞–ø —Ç–∞ –≤—ñ–¥–Ω–æ–≤–ª–µ–Ω–Ω—è

### –°—Ç–≤–æ—Ä–µ–Ω–Ω—è –±–µ–∫–∞–ø—É

```bash
# –ü–æ–≤–Ω–∏–π –±–µ–∫–∞–ø —Å—Ö–µ–º–∏ + –¥–∞–Ω–∏—Ö
supabase db dump -f backup_$(date +%Y%m%d_%H%M%S).sql

# –¢—ñ–ª—å–∫–∏ —Å—Ö–µ–º–∞
supabase db dump --schema-only -f schema.sql

# –¢—ñ–ª—å–∫–∏ –¥–∞–Ω—ñ
supabase db dump --data-only -f data.sql
```

### –í—ñ–¥–Ω–æ–≤–ª–µ–Ω–Ω—è –∑ –±–µ–∫–∞–ø—É

```bash
# –ß–µ—Ä–µ–∑ psql
psql -h db.YOUR_PROJECT_ID.supabase.co -U postgres -d postgres -f backup.sql
```

## üìã –ö–∞—Ç–µ–≥–æ—Ä—ñ—ó —Ç–æ–≤–∞—Ä—ñ–≤

| –ö–∞—Ç–µ–≥–æ—Ä—ñ—è | –û–ø–∏—Å | –ö—ñ–ª—å–∫—ñ—Å—Ç—å |
|-----------|------|-----------|
| –ë—É–¥–º–∞—Ç–µ—Ä—ñ–∞–ª–∏ | –ú–∞—Ç–µ—Ä—ñ–∞–ª–∏ –¥–ª—è –±—É–¥—ñ–≤–Ω–∏—Ü—Ç–≤–∞ | 4 |
| –ó–∞–ø—á–∞—Å—Ç–∏–Ω–∏ | –ê–≤—Ç–æ–∑–∞–ø—á–∞—Å—Ç–∏–Ω–∏ | 5 |
| –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏ | –Ø—â–∏–∫–∏ —Ç–∞ —à–∞—Ñ–∏ | 6 |
| –ù–∞–±–æ—Ä–∏ | –°—Ç–∞—Ä—Ç–æ–≤—ñ –Ω–∞–±–æ—Ä–∏ | 4 |
| –¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç | –ú–∞—à–∏–Ω–∏ —Ç–∞ —Ç–µ—Ö–Ω—ñ–∫–∞ | 5 |

## üèÜ –†—ñ–≤–Ω—ñ –ª–æ—è–ª—å–Ω–æ—Å—Ç—ñ

| –†—ñ–≤–µ–Ω—å | –ú—ñ–Ω. –≤–∏—Ç—Ä–∞—Ç–∏ | –ó–Ω–∏–∂–∫–∞ | –ö–µ—à–±–µ–∫ |
|--------|--------------|--------|--------|
| ü•â –ù–æ–≤–∞—á–æ–∫ | 0‚Ç¥ | 0% | 1% |
| ü•â –ë—Ä–æ–Ω–∑–∞ | 500‚Ç¥ | 2% | 2% |
| ü•à –°—Ä—ñ–±–ª–æ | 2000‚Ç¥ | 5% | 3% |
| ü•á –ó–æ–ª–æ—Ç–æ | 5000‚Ç¥ | 8% | 5% |
| üíé –ü–ª–∞—Ç–∏–Ω–∞ | 10000‚Ç¥ | 12% | 7% |
| üíé –î—ñ–∞–º–∞–Ω—Ç | 25000‚Ç¥ | 15% | 10% |

## üéØ –î–æ—Å—è–≥–Ω–µ–Ω–Ω—è

| –î–æ—Å—è–≥–Ω–µ–Ω–Ω—è | –£–º–æ–≤–∞ | –ù–∞–≥–æ—Ä–æ–¥–∞ |
|------------|-------|----------|
| üéØ –ü–µ—Ä—à–∞ –ø–æ–∫—É–ø–∫–∞ | 1 –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è | 50‚Ç¥ |
| ‚≠ê –ü–æ—Å—Ç—ñ–π–Ω–∏–π –∫–ª—ñ—î–Ω—Ç | 5 –∑–∞–º–æ–≤–ª–µ–Ω—å | 200‚Ç¥ |
| üìù –ö—Ä–∏—Ç–∏–∫ | 3 –≤—ñ–¥–≥—É–∫–∏ | 100‚Ç¥ |
| üèÜ –ï–∫—Å–ø–µ—Ä—Ç | 10 –≤—ñ–¥–≥—É–∫—ñ–≤ | 300‚Ç¥ |
| üíé –í–µ–ª–∏–∫–∏–π –ø–æ–∫—É–ø–µ—Ü—å | 1000‚Ç¥ –≤–∏—Ç—Ä–∞—á–µ–Ω–æ | 150‚Ç¥ |

## ‚ö†Ô∏è –í–∞–∂–ª–∏–≤–æ

1. **–ù–µ —Ä–µ–¥–∞–≥—É–π—Ç–µ** —Ñ–∞–π–ª–∏ –≤ `supabase/migrations/` –≤—Ä—É—á–Ω—É - –≤–æ–Ω–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –≥–µ–Ω–µ—Ä—É—é—Ç—å—Å—è
2. **RLS –ø–æ–ª—ñ—Ç–∏–∫–∏** –æ–±–æ–≤'—è–∑–∫–æ–≤—ñ –¥–ª—è –≤—Å—ñ—Ö —Ç–∞–±–ª–∏—Ü—å –∑ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—Ü—å–∫–∏–º–∏ –¥–∞–Ω–∏–º–∏
3. **–ë–µ–∫–∞–ø–∏** —Ä–µ–∫–æ–º–µ–Ω–¥—É—î—Ç—å—Å—è —Ä–æ–±–∏—Ç–∏ –ø–µ—Ä–µ–¥ –±—É–¥—å-—è–∫–∏–º–∏ –∑–º—ñ–Ω–∞–º–∏
4. –ü—Ä–∏ –∑–º—ñ–Ω—ñ —Å—Ö–µ–º–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ `supabase db diff` –¥–ª—è —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –Ω–æ–≤–∏—Ö –º—ñ–≥—Ä–∞—Ü—ñ–π
